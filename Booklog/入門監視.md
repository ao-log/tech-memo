
### このページについて

[
入門 監視
―モダンなモニタリングのためのデザインパターン](https://www.oreilly.co.jp/books/9784873118642/) のメモです。

### 監視とは

#### 監視とは役割ではなくスキル。

全員が本番環境に責任を持つべき。そのため、チーム内の全員がある程度のレベルに至っておくべき。例えば、ネットワークエンジニア、ソフトウェアエンジニア、各ロールの人はそれぞれの専門分野について何を監視すべきかの勘所が分かっている。よって、より適切な監視をデザインできる。

### 何を監視するか

* 最高のダッシュボードは一つのサービス、プロダクトに焦点を絞ったもの。そのサービスを理解している人たちによって運用されている時が効果的。

* ユーザが気にするのはアプリケーションが使えるかどうか。ユーザ視点の可視化が必要。

* ビジネス視点、アプリの利用に関する KPI を設定する。プロダクトマネージャやエンジニア以外の人と話して、何を設定するかを見出す。

### 監視サービスの選定

* 費用対効果を考えるのであれば SaaS の監視サービスを購入するのも良い。

* 一つの監視ツールだけで監視する必要はない。複数を組み合わせても良い。ツールが合わなくなったら、そのツールだけを置き換えれば良い。


### 監視サービスのコンポーネントとメトリクス

* 監視サービスのコンポーネントは次の通り
  * データ収集
  * データストレージ
  * 可視化
  * 分析とレポート
  * アラート

* メトリクスの表現方法
  * カウンタ。増加していくメトリクス。
  * ゲージ。ある時点での値。時系列データベース(TSDB)に保存することで集計やプロットが可能となる。

### アラート

* すぐに応答が必要なものはアラートとしてページャに送る。
* すぐにアクションが必要ないものはチャットや Web アプリケーションに送ってダッシュボードで見れるようにしておく。
* アラートには対象サービスの手順書へのリンクを入れて、切り分けしやすくする。
* 手順書は人の手で切り分ける必要がある時のためのもの。自動化できるのであれば、自動化してしまえば良い。

### インシデント対応

* インシデント時は二つ以上のう役割兼務は避ける
* 役割は「指揮官」「書記」「コミュニケーション調整役」「インシデント対応する人」。指揮官はエンジニア、調整役がマネージャの方がうまくいく場合もある。

### アプリケーションの監視

* [StatsD](https://github.com/statsd/statsd) でアプリケーションのメトリクスを収集する。サーバレスアプリの監視にも有効。
* /health にアクセスすることでアプリケーションの健全性を取得できるようにする。
* 分散トレーシング。リクエストにIDを付与して識別できるようにする。

### サーバ監視

* OS標準メトリクスからはアラートを設定しない。これらは問題の直接の原因を示すものではなく、何かが起こった結果そのような値が出ている。

